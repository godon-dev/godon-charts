name: "Setup kubernetes kind on osuosl runner"

on:
  workflow_dispatch:

jobs:
  setup_cluster:
    runs-on: [self-hosted, linux]
    steps:
      - name: Checkout
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: Setup kind cluster config
        run: |
          echo "üîß Creating KIND cluster..."
          
          if kind get clusters | grep -q "godon-1-cluster"; then
            echo "‚ùå KIND cluster 'godon-1-cluster' already exists"
            echo "Please delete it first:"
            echo "  kind delete cluster --name godon-1-cluster"
            exit 1
          fi
          
          kind create cluster \
            --config ./kind_config.yaml \
            --name godon-1-cluster \
            --kubeconfig /tmp/kind_kubeconfig.yaml \
            --wait 10m
          
          echo "‚úÖ KIND cluster created successfully"
          kind get clusters
          kubectl cluster-info --kubeconfig=/tmp/kind_kubeconfig.yaml
